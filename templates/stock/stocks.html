{% extends 'base.html' %}

{% block content %}

  <div class="text-center">
    {% for roll in all_rolls %}
      {% if roll.status != "DEPLETED" %}
      <div id="chartContainer" class="col-sm-6" style="width: 30%; height: 30%;display: inline-block;">
        <canvas id="stock-roll-chart-{{ roll.id }}"></canvas>
      </div>
      {% endif %}
    {% endfor %}
  </div>

  <br>
  <a href="{% url 'load-stocks' %}" class="btn btn-sm btn-primary float-lg-right">Load Stocks</a>
  <br>
  <br>

{% for spec, rolls in turf_rolls.items %}

  <div class="card">
    <div class="card-header">
      <h5 class="card-title"><strong>{{ spec.code }}: {{ spec }}</strong></h5>
    </div>
  <div class="card-body">
    <div class="card-content">
      <table id="stocks-table" class="table table-sm table-hover table-borderless">
        <thead style="border-bottom: 1px solid black;">
        <tr>
          <th>ID</th>
          <th>Status</th>
          <th>Available (m<sup>2</sup>)</th>
          <th>Reserved (m<sup>2</sup>)</th>
          <th>Sold (m<sup>2</sup>)</th>
          <th>Warehouse</th>
          <th>Last Sold Date</th>
          <th>Loaded Date</th>
          <th>Actions</th>
        </tr>
        </thead>
        <tbody>
        {# OPENED #}
        {% for roll in rolls %}
          {% if roll.status == "OPENED" %}
          <tr>
            <td>{{ roll.id }}</td>
            <td><a class="btn btn-sm btn-{{ roll.status_color }}" style="pointer-events: none;">{{ roll.status }}</a></td>
            <td class="text-success">{{ roll.available }}</td>

            {% if roll.reserved != 0 %}
              <td><a class="text-warning" style="color: #anycolor !important;" href="{% url 'reserved-orders' roll.id %}">{{ roll.reserved|floatformat:1 }}</a></td>
            {% else %}
              <td>{{ roll.reserved }}</td>
            {% endif %}

            {% if roll.sold != 0 %}
              <td class="text-primary"><a href="{% url "closed-orders" roll.id %}">{{ roll.sold|floatformat:1 }}</a></td>
            {% else %}
              <td>{{ roll.sold }}</td>
            {% endif %}

            <td>{{ roll.location }}</td>
            <td>{{ roll.modified|date:"Y/m/d" }}</td>
            <td>{{ roll.created|date:"Y/m/d" }}</td>
            <td><a href="{% url 'roll-split' roll.id %}" class="btn btn-sm btn-primary">Split</a></td>
          </tr>
          {% endif %}
        {% endfor %}
        {# RETRUNED #}
        {% for roll in rolls %}
          {% if roll.status == "RETURNED" %}
            <tr>
              <td>{{ roll.id }}</td>
              <td><a class="btn btn-sm btn-{{ roll.status_color }}" style="pointer-events: none;">{{ roll.status }}</a></td>
              <td class="text-success">{{ roll.available }}</td>

              {% if roll.reserved != 0 %}
                <td><a class="text-warning" style="color: #anycolor !important;" href="{% url 'reserved-orders' roll.id %}">{{ roll.reserved|floatformat:1 }}</a></td>
              {% else %}
                <td>{{ roll.reserved }}</td>
              {% endif %}

              {% if roll.sold != 0 %}
                <td class="text-primary"><a href="{% url "closed-orders" roll.id %}">{{ roll.sold|floatformat:1 }}</a></td>
              {% else %}
                <td>{{ roll.sold }}</td>
              {% endif %}

              <td>{{ roll.location }}</td>
              <td>{{ roll.modified|date:"Y/m/d" }}</td>
              <td>{{ roll.created|date:"Y/m/d" }}</td>
              <td><a href="{% url 'roll-split' roll.id %}" class="btn btn-sm btn-primary">Split</a></td>
            </tr>
          {% endif %}
        {% endfor %}
        {# SEALED #}
        {% for roll in rolls %}
          {% if roll.status == "SEALED" %}
            <tr>
              <td>{{ roll.id }}</td>
              <td><a class="btn btn-sm btn-{{ roll.status_color }}" style="pointer-events: none;">{{ roll.status }}</a></td>
              <td class="text-success">{{ roll.available }}</td>

              {% if roll.reserved != 0 %}
                <td><a class="text-warning" style="color: #anycolor !important;" href="{% url 'reserved-orders' roll.id %}">{{ roll.reserved|floatformat:1 }}</a></td>
              {% else %}
                <td>{{ roll.reserved }}</td>
              {% endif %}

              {% if roll.sold != 0 %}
                <td class="text-primary"><a href="{% url "closed-orders" roll.id %}">{{ roll.sold|floatformat:1 }}</a></td>
              {% else %}
                <td>{{ roll.sold }}</td>
              {% endif %}

              <td>{{ roll.location }}</td>
              <td>{{ roll.modified|date:"Y/m/d" }}</td>
              <td>{{ roll.created|date:"Y/m/d" }}</td>
              <td><a href="{% url 'roll-split' roll.id %}" class="btn btn-sm btn-primary">Split</a></td>
            </tr>
          {% endif %}
        {% endfor %}
        {# LOOSE #}
        {% for roll in rolls %}
          {% if roll.status == "LOOSE" or roll.status == "RETURNED" %}
            <tr>
              <td>{{ roll.id }}</td>
              <td><a class="btn btn-sm btn-{{ roll.status_color }}" style="pointer-events: none;">{{ roll.status }}</a></td>
              <td class="text-success">{{ roll.available }}</td>

              {% if roll.reserved != 0 %}
                <td><a class="text-warning" style="color: #anycolor !important;" href="{% url 'reserved-orders' roll.id %}">{{ roll.reserved|floatformat:1 }}</a></td>
              {% else %}
                <td>{{ roll.reserved }}</td>
              {% endif %}

              {% if roll.sold != 0 %}
                <td class="text-primary"><a href="{% url "closed-orders" roll.id %}">{{ roll.sold|floatformat:1 }}</a></td>
              {% else %}
                <td>{{ roll.sold }}</td>
              {% endif %}

              <td>{{ roll.location }}</td>
              <td>{{ roll.modified|date:"Y/m/d" }}</td>
              <td>{{ roll.created|date:"Y/m/d" }}</td>
              <td><a href="{% url 'roll-split' roll.id %}" class="btn btn-sm btn-primary">Split</a></td>
            </tr>
          {% endif %}
        {% endfor %}
        {# DEPLETED #}
        {% for roll in rolls %}
          {% if roll.status == "DEPLETED" %}
            <tr>
              <td>{{ roll.id }}</td>
              <td><a class="btn btn-sm btn-{{ roll.status_color }}" style="pointer-events: none;">{{ roll.status }}</a></td>
              <td class="text-success">{{ roll.available }}</td>

              {% if roll.reserved != 0 %}
                <td><a class="text-warning" style="color: #anycolor !important;" href="{% url 'reserved-orders' roll.id %}">{{ roll.reserved|floatformat:1 }}</a></td>
              {% else %}
                <td>{{ roll.reserved }}</td>
              {% endif %}

              {% if roll.sold != 0 %}
                <td class="text-primary"><a href="{% url "closed-orders" roll.id %}">{{ roll.sold|floatformat:1 }}</a></td>
              {% else %}
                <td>{{ roll.sold }}</td>
              {% endif %}

              <td>{{ roll.location }}</td>
              <td>{{ roll.modified|date:"Y/m/d" }}</td>
              <td>{{ roll.created|date:"Y/m/d" }}</td>
              <td style="text-align: justify">-</td>
            </tr>
          {% endif %}
        {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
  </div>
  <br>
{% endfor %}

  <script>

      var endpoint = "/api/stock/data/";
      {#var defaultData = [];#}
      {#var labels = [];#}
      $.ajax({
          method: "GET",
          url: endpoint,
          success: function (data) {
              console.log(data);
              Object.keys(data).forEach(function(key) {
                  console.table('Key : ' + key + ', Value : ' + data[key].code)
                  var chart_id = "stock-roll-chart-" + (key).toString();
                  console.log(chart_id);
                  var default_data = data[key].default;
                  var labels = data[key].labels;
                  var code = data[key].code + " - Roll ID: " + key.toString();
                  console.log(chart_id);
                  var ctx = document.getElementById(chart_id);
                  setDoughnutChart(labels, default_data, ctx, code);
              })

          },
          error: function (error_data) {
              console.log("error");
              console.log(error_data);
          }
      });

      function setDoughnutChart(labels, defaultData, ctx, code) {
          var myChart = new Chart(ctx, {
              type: "doughnut",
              data: {
                  labels: labels,
                  datasets: [{
                      label: "mÂ²",
                      data: defaultData,
                      backgroundColor: ["#32CD32", "#949FB1", "#FDB45C", "#FFFFFF", "#46BFBD", "#4D5360", "#F7464A"],
                      hoverBackgroundColor: ["#7CFC00", "#A8B3C5", "#FFC870", "#FFFFFF", "#5AD3D1", "#616774", "#FF5A5E"],
                      {#borderColor: [#}
                      {#    'rgba(255, 99, 132, 1)',#}
                      {#    'rgba(54, 162, 235, 1)',#}
                      {#    'rgba(255, 206, 86, 1)',#}
                      {#    'rgba(75, 192, 192, 1)',#}
                      {#    'rgba(153, 102, 255, 1)',#}
                      {#    'rgba(255, 159, 64, 1)'#}
                      {#],#}
                      borderWidth: 1.5
                  }]
              },
              options: {
                  maintainAspectRatio: false,
                  responsive: true,
                  legend: {
                      display: false,
                      labels: {
                          fontSize: 10
                      }
                  },
                  title: {
                      display: true,
                      text: code,
                      fontStyle: "bold"
                  }
              }
          });
      }


  </script>


{% endblock %}
