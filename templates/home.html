{% extends 'base.html' %}

{% block content %}
  <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h2 class="h3">Dashboard</h2>
    <div class="btn-toolbar mb-2 mb-md-0">
      <div class="btn-group mr-2">
        <button type="button" class="btn btn-sm btn-outline-secondary">Share</button>
        <button type="button" class="btn btn-sm btn-outline-secondary">Export</button>
      </div>
      <button type="button" class="btn btn-sm btn-outline-secondary dropdown-toggle">
        <span data-feather="calendar"></span>
        This week
      </button>
    </div>
  </div>
  <br>
  <div class="text-center">
    <div id="chartContainer" class="col-sm-6" style="width: 45%; height: 50%;display: inline-block;">
      <canvas id="stock-chart"></canvas>
    </div>
    <div id="chartContainer" class="col-sm-6" style="width: 45%; height: 50%;display: inline-block;">
      <canvas id="sales-chart"></canvas>
    </div>
    <div id="chartContainer" class="col-sm-6" style="width: 45%; height: 50%;display: inline-block;">
      <canvas id="product-chart"></canvas>
    </div>
    <div id="chartContainer" class="col-sm-6" style="width: 45%; height: 50%;display: inline-block;">
      <canvas id="buyer-chart"></canvas>
    </div>
  </div>
  <br>
  <br>
  <br>
  <div>
    <h3 class="h3">Recent Opened Orders</h3>
    <hr>
    <div class="table-responsive">
      <table id="recent-orders-table" class="display table table-responsive-sm table-hover">
        <thead class="thead-dark">
        <tr>
          <th>Order #</th>
          <th>Buyer</th>
          <th>Total</th>
          <th>Created Date</th>
          <th>Last Updated</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
        </thead>
        <tbody>
        {% for order in recent_orders %}
          <tr>
            <td><a href="{% url 'order' order.id %}"><span>{{ order.number }}</span></a></td>
            <td>{{ order.buyer.name }}</td>
            <td>{{ order.total_amount }}</td>
            <td>{{ order.created }}</td>
            <td>{{ order.modified }}</td>
            <td><a class="btn btn-sm btn-{{ order.status_color }}" style="pointer-events: none;">{{ order.status }}</a>
            </td>
            <td>
              <a href=""><span data-feather="edit"></span></a>
              <a href=""><span data-feather="trash-2"></span></a>
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
  <script>
      function getRandomColor() {
          var letters = '0123456789ABCDEF'.split('');
          var color = '#';
          for (var i = 0; i < 6; i++) {
              color += letters[Math.floor(Math.random() * 16)];
          }
          return color;
      }

      $(document).ready(function () {
          var oTable = $('#recent-orders-table').dataTable();
          oTable.fnSort(
              [
                  [4, 'des'],
              ]
          );
      });
      var endpoint = "/api/chart/data/";
      var customer = parseInt("{{ data.customers }}");
      var defaultData = [];
      var labels = [];
      $.ajax({
          method: "GET",
          url: endpoint,
          success: function (data) {
              var stock_data = data.stock_data;
              var sales_data = data.sales_data;
              var product_data = data.product_data;
              var buyer_data = data.buyer_data;
              var ctx = document.getElementById('stock-chart');
              setBarChart(stock_data.labels, stock_data.default, ctx);
              ctx = document.getElementById('sales-chart');
              setLineChart(sales_data.labels, sales_data.default, ctx);
              ctx = document.getElementById('buyer-chart');
              setBuyerChart(buyer_data.labels, buyer_data.default, ctx);
              ctx = document.getElementById('product-chart');
              setProductChart(product_data.labels, product_data.default, ctx);
          },
          error: function (error_data) {
              console.log("error");
              console.log(error_data);
          }
      });

      function setBarChart(labels, defaultData, ctx) {
          var myChart = new Chart(ctx, {
              type: "bar",
              data: {
                  labels: labels,
                  datasets: [{
                      label: "Number of m² left",
                      data: defaultData,
                      backgroundColor: [
                          'rgba(255, 99, 132, 1)',
                          'rgba(54, 162, 235, 1)',
                          'rgba(255, 206, 86, 1)',
                          'rgba(75, 192, 192, 1)',
                          'rgba(153, 102, 255, 1)',
                          'rgba(255, 159, 64, 1)'
                      ],
                      borderColor: [
                          'rgba(255, 99, 132, 1)',
                          'rgba(54, 162, 235, 1)',
                          'rgba(255, 206, 86, 1)',
                          'rgba(75, 192, 192, 1)',
                          'rgba(153, 102, 255, 1)',
                          'rgba(255, 159, 64, 1)'
                      ],
                      borderWidth: 1.5
                  }]
              },
              options: {
                  scales: {
                      yAxes: [
                          {
                            ticks: {
                                beginAtZero: true
                            },
                            scaleLabel: {
                                display: true,
                                labelString: 'm²',
                                fontStyle: "bold"
                            }
                        }
                      ],
                      xAxes: [
                          {
                              ticks: {
                                  stepSize: 1,
                                  autoSkip: false
                              },
                              scaleLabel: {
                                  display: true,
                                  labelString: 'Product Code',
                                  fontStyle: "bold"
                              },
                          }
                      ]
                  },
                  legend: {display: false},
                  title: {
                      display: true,
                      text: 'Available stocks in m²',
                      fontStyle: "bold"
                  }
              }
          });
      }

      function setBuyerChart(labels, defaultData, ctx) {

          var myChart = new Chart(ctx, {
              type: "bar",
              data: {
                  labels: labels,
                  datasets: [{
                      label: "Total sales per buyer in Rand",
                      data: defaultData,
                      backgroundColor: [
                          'rgba(255, 99, 132, 1)',
                          'rgba(54, 162, 235, 1)',
                          'rgba(255, 206, 86, 1)',
                          'rgba(75, 192, 192, 1)',
                          'rgba(153, 102, 255, 1)',
                          'rgba(255, 159, 64, 1)'
                      ],
                      borderColor: [
                          'rgba(255, 99, 132, 1)',
                          'rgba(54, 162, 235, 1)',
                          'rgba(255, 206, 86, 1)',
                          'rgba(75, 192, 192, 1)',
                          'rgba(153, 102, 255, 1)',
                          'rgba(255, 159, 64, 1)'
                      ],
                      borderWidth: 1.5
                  }]
              },
              options: {
                  scales: {
                      yAxes: [{
                          ticks: {
                              beginAtZero: true
                          },

                          scaleLabel: {
                              display: true,
                              labelString: 'Rand',
                              fontStyle: "bold"
                          }
                      }],
                      xAxes: [{
                          scaleLabel: {
                              display: true,
                              labelString: 'Buyer Name',
                              fontStyle: "bold"
                          }
                      }]
                  },
                  legend: {display: false},
                  title: {
                      display: true,
                      text: 'Total sales per buyer in Rand',
                      fontStyle: "bold"
                  }
              }
          });
      }

      function setProductChart(labels, defaultData, ctx) {

          var myChart = new Chart(ctx, {
              type: "bar",
              data: {
                  labels: labels,
                  datasets: [{
                      label: "Total sales per product in Rand",
                      data: defaultData,
                      backgroundColor: [
                          'rgba(255, 99, 132, 1)',
                          'rgba(54, 162, 235, 1)',
                          'rgba(255, 206, 86, 1)',
                          'rgba(75, 192, 192, 1)',
                          'rgba(153, 102, 255, 1)',
                          'rgba(255, 159, 64, 1)'
                      ],
                      borderColor: [
                          'rgba(255, 99, 132, 1)',
                          'rgba(54, 162, 235, 1)',
                          'rgba(255, 206, 86, 1)',
                          'rgba(75, 192, 192, 1)',
                          'rgba(153, 102, 255, 1)',
                          'rgba(255, 159, 64, 1)'
                      ],
                      borderWidth: 1.5
                  }]
              },
              options: {
                  scales: {
                      yAxes: [{
                          ticks: {
                              beginAtZero: true
                          },

                          scaleLabel: {
                              display: true,
                              labelString: 'Rand',
                              fontStyle: "bold"
                          }
                      }],
                      xAxes: [{
                          scaleLabel: {
                              display: true,
                              labelString: 'Product Code',
                              fontStyle: "bold"
                          }
                      }]
                  },
                  legend: {display: false},
                  title: {
                      display: true,
                      text: 'Total sales per product in Rand',
                      fontStyle: "bold"
                  }
              }
          });
      }

      function setLineChart(labels, defaultData, ctx) {
          var myChart = new Chart(ctx, {
              type: "line",
              data: {
                  labels: labels,
                  datasets: [{
                      label: "Order of Sales (R)",
                      data: defaultData,
                      borderColor: "#3e95cd",
                      fill: false,
                      {#backgroundColor: bgcolors,#}
                      {#borderColor: bdcolors,#}
                      {#backgroundColor: [#}
                      {#    'rgba(255, 99, 132, 0.2)',#}
                      {#    'rgba(54, 162, 235, 0.2)',#}
                      {#    'rgba(255, 206, 86, 0.2)',#}
                      {#    'rgba(75, 192, 192, 0.2)',#}
                      {#    'rgba(153, 102, 255, 0.2)',#}
                      {#    'rgba(255, 159, 64, 0.2)'#}
                      {#],#}
                      {#borderColor: [#}
                      {#    'rgba(255, 99, 132, 1)',#}
                      {#    'rgba(54, 162, 235, 1)',#}
                      {#    'rgba(255, 206, 86, 1)',#}
                      {#    'rgba(75, 192, 192, 1)',#}
                      {#    'rgba(153, 102, 255, 1)',#}
                      {#    'rgba(255, 159, 64, 1)'#}
                      {#],#}
                      borderWidth: 2
                  }]
              },
              options: {
                  title: {
                      display: true,
                      text: 'Total Accumulated Sales (in Rand)'
                  },
                  legend: {display: false},
                  scales: {
                      yAxes: [
                          {
                              ticks: {
                                  beginAtZero: true
                              },

                              scaleLabel: {
                                  display: true,
                                  labelString: 'Rand'
                              }
                          }
                      ],
                      xAxes: [
                          {
                              scaleLabel: {
                                  display: true,
                                  labelString: 'Order Closed Date'
                              }
                          }
                      ]
                  }
              }
          });
      }

  </script>
{% endblock %}
